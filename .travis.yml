language: node_js
node_js:
  - 14.8.0
install: ./install.sh

before_script:
  - if [ $TRAVIS_BRANCH == "master" ]; then
      sudo aws s3 rm s3://noahvarghese.me/ --recursive;
      ls -la
    elif [ $TRAVIS_BRANCH == "test" ]; then
      sudo aws s3 rm s3://test.noahvarghese.me/ --recursive;
      ls -la
    fi

script: gatsby clean && gatsby build
# safelist
branches:
  only:
  - master
  - test
deploy:
  provider: s3
  access_key_id: $AWS_KEY
  secret_access_key: $AWS_SECRET
  bucket: noahvarghese.me
  acl: public_read
  region: ca-central-1
  on: 
    branch: master
  local_dir: public
  provider: s3 
  access_key_id: $AWS_KEY
  secret_access_key: $AWS_SECRET
  bucket: test.noahvarghese.me
  acl: public_read
  region: ca-central-1
  on:
    branch: test
  local_dir: public

after_deploy: 
  - if [ $TRAVIS_BRANCH == "master" ]; then
      sudo aws s3 rm s3://noahvarghese.me/src --recursive;
    elif [ $TRAVIS_BRANCH == "test" ]; then
      sudo aws s3 rm s3://test.noahvarghese.me/src --recursive;
    fi
  