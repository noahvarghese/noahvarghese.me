language: node_js
node_js:
  - 14.8.0
install: ./install.sh

before_script:
  - if [ $TRAVIS_BRANCH == "master" ]; then
      sudo aws s3 rm s3://noahvarghese.me/ --recursive;
    elif [ $TRAVIS_BRANCH == "test" ]; then
      sudo aws s3 rm s3://test.noahvarghese.me/ --recursive;
    fi

script: gatsby clean && gatsby build

after_script: pwd && ls -la;

before_deploy: pwd && ls -la

# safelist
branches:
  only:
  - master
  - test
deploy:
  provider: s3
  access_key_id: $AWS_KEY
  secret_access_key: $AWS_SECRET
  bucket: noahvarghese.me
  acl: public_read
  region: ca-central-1
  skip_cleanup: true
  local_dir: ./public
  on: 
    branch: master
  local_dir: public
  provider: s3 
  access_key_id: $AWS_KEY
  secret_access_key: $AWS_SECRET
  bucket: test.noahvarghese.me
  acl: public_read
  region: ca-central-1
  skip_cleanup: true
  local_dir: .
  on:
    branch: test

after_deploy: 
  - if [ $TRAVIS_BRANCH == "master" ]; then
      sudo aws s3 rm s3://noahvarghese.me/src --recursive;
    elif [ $TRAVIS_BRANCH == "test" ]; then
      sudo aws s3 rm s3://test.noahvarghese.me/src --recursive;
    fi
  